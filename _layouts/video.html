{% include header.html %}

{% assign strpart = page.part | downcase %}
{% assign strNextVideo = page.nextVideo | downcase %}
{% assign strPrevVideo = page.prevVideo | downcase %}

{% for playlist in site.data.videos %}
{% if playlist.short == page.playlist %}

{% for video in playlist.videos %}
{% if video.id == strpart %}

{% assign nextVideoI = forloop.index0 | minus: 1 %}
{% assign nextVideo = playlist.videos[nextVideoI] %}
{% assign prevVideoI = forloop.index0 | plus: 1 %}
{% assign prevVideo = playlist.videos[prevVideoI] %}

{% if video.title %}
{% assign title = video.title %}
{% else %}
{% assign title = playlist.title | append: " Teil " | append: strpart %}
{% endif %}

<video-js
        id="player"
        class="video-js vjs-big-play-centered"
        controls
        preload="auto"
        style="width: 100%; height: /*57.8em*/43em;"
        poster="/thumbs/{{ playlist.name }}_{{ strpart }}.jpg" data-setup="{}">
{% for upload in video.uploads %}
{% if upload.id contains ".webm" %}
{% assign contentType = "video/webm" %}
{% else %}
{% assign contentType = "video/mp4" %}
{% endif %}

{% if upload.hoster == "archive" and upload.resolution == 1080 %}
{% assign selected = 'selected="true"' %}
{% else %}
{% assign selected = "" %}
{% endif %}

{% if upload.hoster == "archive" %}
    <source src="https://archive.org/download/{{ upload.id }}" type="{{ contentType }}" label="{{ upload.resolution }}p (archive)" {{ selected }}>
{% elsif upload.hoster == "dropbox" %}
    <source src="https://dl.dropboxusercontent.com/s/{{ upload.id }}" type="{{ contentType }}" label="{{ upload.resolution }}p (dropbox)" {{ selected }}>
{% endif %}
{% endfor %}

    <p class="vjs-no-js">
        To view this video please enable JavaScript, and consider upgrading to a web browser that
        <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
    </p>
</video-js>

<script>window.HELP_IMPROVE_VIDEOJS = false;</script>
<script src="/assets/js/video.min.js"></script>
<script src="/assets/js/videojs.quality-selector.min.js"></script>
<script src="/assets/js/videojs.youtube.js"></script>
<script src="/assets/js/videojs.hotkeys.js"></script>
<script src="/assets/js/videojs.titleoverlay.js"></script>
<script>
    videojs("player", {}, function() {
        var player = this;
        player.controlBar.removeChild('FullscreenToggle');
        player.controlBar.addChild('QualitySelector');
        player.controlBar.addChild('FullscreenToggle');
    });

    videojs("player").ready(function() {
        this.hotkeys({
            volumeStep: 0.1,
            seekStep: 5,
            enableModifiersForNumbers: false
        });
    });

    videojs("player").titleoverlay({
        title: "{{ title }}",  //Title for movie
        floatPosition: "left", //Float left or right (to prevent big play button overlap) (default left)
        margin: "16px", //Margin from top/left/right (default 10px)
        fontSize: "2em", //font size (default 1em)
        debug: false, //true or false. Will output debug messages for title status
    });
</script>

<div class="w3-card w3-padding">
<div class="w3-container w3-cell-row">
    {% if page.prevVideo %}
        {% assign prevTitle = prevVideo.title %}
        {% unless prevTitle %}
            {% assign prevTitle = "Teil " | append: strPrevVideo %}
        {% endunless %}

        <a class="w3-cell w3-mobile w3-card w3-display-container" style="width: 20.088em; max-width: 20.088em;" href="/{{ playlist.short }}/{{ page.prevVideo | prepend: '00' | slice: -2, 2 }}">
            <div style="width: 20.088em; height: 11.3em; background: #000000;">
                <img class="w3-display-middle" alt="Thumbnail" src="/thumbs/{{ playlist.name }}_{{ page.prevVideo }}.small.jpg">
            </div>
            <div class="w3-small w3-display-bottommiddle w3-black w3-center w3-opacity-min w3-padding" style="width: 100%;">{{ prevTitle }}</div>
        </a>
    {% else %}
        <div class="w3-cell w3-mobile" style="width: 20.088em">
        </div>
    {% endif %}

    <div class="w3-cell w3-mobile" style="width: 1em">
    </div>

    <a class="w3-cell w3-mobile w3-card w3-display-container" style="width: 20.088em; max-width: 20.088em;" href="/{{ playlist.short }}">
        <div style="width: 20.088em; height: 11.3em; background: #000000;">
            <img class="w3-display-middle" alt="Thumbnail" src="/thumbs/{{ playlist.name }}.small.jpg">
        </div>
        <div class="w3-small w3-display-bottommiddle w3-black w3-center w3-opacity-min w3-padding" style="width: 100%;">{{ playlist.title | prepend: "Übersicht: " }}</div>
    </a>

    <div class="w3-cell w3-mobile" style="width: 1em">
    </div>

    {% if page.nextVideo %}
        {% assign available_soon = nextVideo.available_soon %}

        {% assign nextTitle = nextVideo.title %}
        {% unless nextTitle %}
            {% assign nextTitle = "Teil " | append: strNextVideo %}
        {% endunless %}

        <div
        {% if available_soon %}
            class="w3-grayscale-max w3-opacity w3-cell w3-mobile w3-card w3-display-container"
        {% else %}
            class="w3-cell w3-mobile w3-card w3-display-container"
        {% endif %}
            style="width: 20.088em; max-width: 20.088em;">

            {% unless available_soon %}
            <a href="/{{ playlist.short }}/{{ page.nextVideo | prepend: '00' | slice: -2, 2 }}">
            {% endunless %}
                <div style="width: 20.088em; height: 11.3em; background: #000000;">
                    <img class="w3-display-middle" alt="Thumbnail" src="/thumbs/{{ playlist.name }}_{{ page.nextVideo }}.small.jpg">
                </div>
                <div class="w3-small w3-display-bottommiddle w3-black w3-center w3-opacity-min w3-padding" style="width: 100%;">{{ nextTitle }}</div>
            {% unless available_soon %}
            </a>
            {% endunless %}
        </div>
    {% else %}
        <div class="w3-cell w3-mobile" style="width: 20.088em">
        </div>
    {% endif %}
</div>

<h1>{{ title }}</h1>

<p class="w3-padding w3-small">
    {% for upload in video.uploads %}
    {% if upload.id %}
    {% if upload.hoster == "youtube" %}
    <a class="w3-btn w3-red w3-margin-left w3-margin-right" target="_blank" href="https://youtube.com/watch?v={{ upload.id }}">YouTube ({{ upload.resolution }}p)</a>
    {% elsif upload.hoster == "twitch" %}
    <a class="w3-btn w3-purple w3-margin-left w3-margin-right" target="_blank" href="https://www.twitch.tv/videos/{{ upload.id }}">Twitch ({{ upload.resolution }}p)</a>
    {% elsif upload.hoster == "vimeo" %}
    <a class="w3-btn w3-blue w3-margin-left w3-margin-right" target="_blank" href="https://vimeo.com/{{ upload.id }}">Vimeo ({{ upload.resolution }}p)</a>
    {% elsif upload.hoster == "archive" %}
    <a class="w3-btn w3-black w3-margin-left w3-margin-right" target="_blank" href="https://archive.org/download/{{ upload.id }}">archive.org ({{ upload.resolution }}p)</a>
    {% elsif upload.hoster == "dropbox" %}
    <a class="w3-btn w3-blue w3-margin-left w3-margin-right" target="_blank" href="https://dl.dropboxusercontent.com/s/{{ upload.id }}">Dropbox ({{ upload.resolution }}p)</a>
    {% elsif hoster[0] == "openload" %}
    <a class="w3-btn w3-light-blue w3-margin-left w3-margin-right" target="_blank" href="https://openload.co/embed/{{ upload.id }}">openload ({{ upload.resolution }}p)</a>
    {% endif %}
    {% endif %}
    {% endfor %}
</p>

<p><b>Veröffentlicht am {{ video.date | date_to_string }}</b></p>

<p>{{ video.description }}</p>
</div>

{% endif %}
{% endfor %}
{% endif %}
{% endfor %}

{% include footer.html %}
